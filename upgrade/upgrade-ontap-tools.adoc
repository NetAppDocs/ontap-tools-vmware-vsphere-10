---
permalink: upgrade/upgrade-ontap-tools.html
sidebar: sidebar
keywords: upgrade
summary: 'Upgrade is supported for both HA and non-HA deployments.'
---
= Upgrade from ONTAP tools for VMware vSphere 10.x to 10.5
:icons: font
:imagesdir: ../media/

[.lead]
You can upgrade from ONTAP tools for VMware vSphere 10.3 or 10.4 to 10.5. However, to upgrade from ONTAP tools 10.0, 10.1, or 10.2 to 10.5, you must first upgrade to 10.3 or 10.4 before proceeding to 10.5.

NOTE:

* For ASA r2 systems, make sure you upgrade to ONTAP tools for VMware vSphere 10.5 with ONTAP 9.16.1 before setting up more storage availability zones (SAZs).
// https://jira.ngage.netapp.com/browse/OTVDOC-254 updates
* If the upgrade from ONTAP tools for VMware vSphere 10.3 or 10.4 to 10.5 fails, you can't roll back. Use low RPO/snapshot recovery to restore the setup. For ONTAP tools for VMware vSphere 10.2 and lower versions, you can restore the setup using the RPO.

.Before you begin

Before upgrading, ensure the ONTAP system certificate is valid for at least 5 days. If it expires sooner, the upgrade fails.

// 10.5 updates - Jani certificate feature.
For a non-HA upgrade, power off the ONTAP tools VM, and for an HA upgrade, power off the first node before making the any changes to the virtual machine (VM) settings.

Add an additional 100 GB Hard Disk Drive (HDD) to each node, because the service data is stored locally on the VM. To add an HDD, do the following:

** Select the VM in single node configuration or all three VMs in HA configuration.
** Right-click on the VM(s) and select *Add New Device* > *Hard Disk*
** Add a 100 GB HDD in the *New Hard disk* field.
** Select *Apply*
+
After adding a hard disk, the system creates a new HDD, which the dynamic storage provisioner uses to create or replicate volumes.

If upgrading from ONTAP tools for VMware vSphere 10.2, 10.3, or 10.4, complete these steps:


* Change the CPU and memory for the powered-off VM according to the flavor of your deployment.

|===
|Deployment Type |CPU(Core) per node |Memory(GB) per node |Disk Space(GB) per node| Total CPU(Core) |Memory(GB) |Total Disk Space(GB)

|Non-HA Small
|9
|18
|350
|9
|18
|350

|Non-HA Medium
|13
|26
|350
|13
|26
|350


|HA Small
|9
|18
|350
|27
|54
|1050


|HA Medium
|13
|26
|350
|39
|78
|1050


|HA Large
|17
|34
|350
|51
|102
|1050

|===

* Enable the hot plugin for CPU and RAM.
* Power on the VM after making changes and wait for services to start.
* In case of HA deployment, after updating the resources and enabling the hot plugin for CPU and RAM, add 100 GB hard disks for the second and third nodes as well. You don't need to reboot these nodes.
* If the appliance is deployed using the local path (easy deployment) option in ONTAP tools for VMware vSphere 10.2, take a quiesced snapshot before upgrading.

*Take a backup of MongoDB*

Run the following commands to take a backup of MongoDB:

* kn exec -it ntv-mongodb-0 sh - kn is an alias of kubectl -n ntv-system.
* Run _env | grep MONGODB_ROOT_PASSWORD_ command inside the pod.
* Run _exit_ command to exit the pod.
* Run _kn exec ntv-mongodb-0 --mongodump -u root -p MONGODB_ROOT_PASSWORD --archive=/tmp/mongodb-backup.gz --gzip_ command to replace the MONGO_ROOT_PASSWORD set from the above command.
* Run _kn cp ntv-mongodb-0:/tmp/mongodb-backup.gz ./mongodb-backup.gz_ command to copy the mongodb backup you created using the above command from the pod to the host.

*Take a quiesced snapshot of all the volumes*

* Run 'kn get pvc' command and save the command output.
* Take snapshots of each volume using one of the following methods:
** From CLI, run the command _volume snapshot create -vserver <vserver_name> -volume <volume_name> -snapshot <snapshot_name>_
** From the ONTAP System Manager user interface, search the volume by its name in the search bar, then open that volume by selecting on the name. Go to snapshot and add the snapshot of that volume.

*Take a snapshot of each ONTAP tools for VMware vSphere VM in vCenter (3 VMs for HA deployment, 1 VM for non-HA deployment).*

* In the vSphere client user interface, select the VM.
* Go to the snapshots tab and select the *Take Snapshot* button. Take a quiesced snapshot of the VM. Refer to https://techdocs.broadcom.com/us/en/vmware-cis/vsphere/vsphere/8-0/take-snapshots-of-a-virtual-machine.html[Take a Snapshot of a Virtual Machine^] for details.

Before upgrading, delete completed pods with the prefix “generate-support-bundle-job.” If a support bundle is generating, wait until it finishes, and then delete the pod.

If you're upgrading from ONTAP tools for VMware vSphere 10.0 to 10.1, enable the diagnostic access using the following steps:

. From the vCenter Server, open a console to ONTAP tools.
. Log in as the maintenance user.
. Enter *4* to select *Support and Diagnostics*.
. Enter *2* to select *Enable remote diagnostic access*.
. Enter *y* to set the password of your choice.
. Log in to the VM IP address from the terminal/putty with the user as 'diag' and the password that was set in the previous step.


.Steps

. Upload ONTAP tools for VMware vSphere upgrade ISO to content library.
. In the primary VM page, select *Actions* > *Edit Settings* 
. Select the *content library ISO file* in the edit settings window under the *CD/DVD drive* field. 
. Select the ISO file, check the *Connected* box for the *CD/DVD drive* field, and click *OK*.
image:../media/primaryvm-edit-settings.png[Edit settings]
. From the vCenter Server, open a console to ONTAP tools.
. Log in as the maintenance user.
. Enter *3* to select the *System Configuration* menu.
. Enter *7* to select the *Upgrade* option.
. When you upgrade, the following actions are performed automatically:
.. Certificate upgrade
.. Remote plug-in upgrade

.What's next

After upgrading to ONTAP tools for VMware vSphere 10.5, rescan the SRA adapters to update the VMware Live Site Recovery Storage Replication Adapters page.
// OTVDOC-167 - updated by jani

After upgrading you can: 

* Disable the services from the manager user interface
* Move from a non-HA setup to an HA setup
* Scale up a non-HA small configuration to a non-HA medium, or to an HA medium or large configuration.
* For a non-HA upgrade, reboot the ONTAP tools VM to show the changes. For an HA upgrade, reboot the first node to show the changes on the node.

After upgrading, manually delete the Trident volumes from ONTAP using the following procedure:

[NOTE]
These steps aren't required if the ONTAP tools for VMware vSphere 10.1 or 10.2 is in non-HA small or medium (local path) configurations.

. From the vCenter Server, open a console to ONTAP tools.
. Log in as the maintenance user.
. Enter *4* to select the *Support and Diagnostics* menu.
. Enter *1* to select the *Access diagnostics shell* option.
. Run the following command
+
----
sudo python3 /home/maint/scripts/ontap_cleanup.py
----
. Enter the ONTAP username and password

This deletes all the Trident volumes in ONTAP used in ONTAP tools for VMware vSphere 10.1/10.2.

.Related information

link:../migrate/migrate-to-latest-ontaptools.html[Migrate from ONTAP tools for VMware vSphere 9.xx to 10.5]
// OTVDOC-164 - jani